<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet author="han (generated)" id="1561102935905-1">
        <createTable tableName="ts_sub_task">
            <column autoIncrement="true" name="id" remarks="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="sub_task_num" remarks="子任务编号" type="VARCHAR(32)"/>
            <column name="sub_task_typ" remarks="子任务类型" type="VARCHAR(32)"/>
            <column name="sub_task_seq" remarks="子任务执行顺序" type="INT"/>
            <column name="main_task_num" remarks="主任务编号" type="VARCHAR(256)"/>
            <column name="main_task_seq" remarks="主任务执行顺序" type="INT"/>
            <column name="main_task_type" remarks="任务类型（主任务）" type="VARCHAR(32)"/>
            <column name="group_flag" remarks="任务组/子任务" type="VARCHAR(32)"/>
            <column name="task_group_code" remarks="任务组编号" type="VARCHAR(255)"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="task_msg" remarks="任务消息体" type="VARCHAR(2000)"/>
            <column name="send_status" remarks="下发状态" type="VARCHAR(32)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="need_confirm" remarks="需要确认" type="VARCHAR(2)"/>
            <column name="need_inform" remarks="是否通知" type="VARCHAR(2)"/>
            <column name="need_trigger" remarks="是否需要触发" type="VARCHAR(2)"/>
            <column name="trigger_type" remarks="通过什么字段触发任务：任务号、呼叫号、系统自动、设备号、条件触发" type="VARCHAR(16)"/>
            <column name="condition_handler" remarks="条件触发类型下必填，根据业务拓展" type="VARCHAR(255)"/>
            <column name="third_invoke_type" remarks="sqop/rest/tcp" type="VARCHAR(255)"/>
            <column name="third_type" remarks="第三方(应用)类型" type="VARCHAR(255)"/>
            <column name="app_code" remarks="应用编号" type="VARCHAR(255)"/>
            <column name="third_url" remarks="第3方路径" type="VARCHAR(255)"/>
            <column name="third_start_method" remarks="任务开始3方通知方法" type="VARCHAR(255)"/>
            <column name="third_end_method" remarks="任务结束3方通知方法" type="VARCHAR(255)"/>
            <column name="point_access" remarks="如：固定点、线路、呼叫路径、关联点、主叫号、策略配置、电梯等待位、关联区域" type="VARCHAR(255)"/>
            <column name="sequence" remarks="执行顺序" type="INT"/>
            <column name="cancel_flag" remarks="取消标志" type="INT"/>
            <column name="cancel_id" remarks="取消id" type="INT"/>
            <column name="cancel_type" remarks="取消类型" type="VARCHAR(64)"/>
            <column name="date_chg" remarks="更新时间" type="VARCHAR(64)"/>
            <column name="group_id" remarks="组id" type="VARCHAR(64)"/>
            <column name="loop_exec" remarks="循环执行" type="VARCHAR(2)"/>
            <column name="priority" remarks="优先级" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561102935905-2">
        <createTable tableName="ts_sub_task_log">
            <column autoIncrement="true" name="id" remarks="子任务日志id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="sub_task_num" remarks="子任务编号" type="VARCHAR(32)"/>
            <column name="sub_task_typ" remarks="子任务类型" type="VARCHAR(32)"/>
            <column name="sub_task_seq" remarks="子任务执行顺序" type="INT"/>
            <column name="main_task_num" remarks="主任务编号" type="VARCHAR(256)"/>
            <column name="main_task_seq" remarks="主任务执行顺序" type="INT"/>
            <column name="main_task_type" remarks="任务类型（主任务）" type="VARCHAR(32)"/>
            <column name="group_flag" remarks="任务组/子任务" type="VARCHAR(32)"/>
            <column name="task_group_code" remarks="任务组编号" type="VARCHAR(255)"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="date_chg" remarks="更新时间" type="VARCHAR(64)"/>
            <column name="task_msg" remarks="任务消息体" type="VARCHAR(2000)"/>
            <column name="send_status" remarks="下发状态" type="VARCHAR(32)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="need_confirm" remarks="需要确认" type="VARCHAR(2)"/>
            <column name="need_inform" remarks="是否通知" type="VARCHAR(2)"/>
            <column name="need_trigger" remarks="是否需要触发" type="VARCHAR(2)"/>
            <column name="trigger_type" remarks="通过什么字段触发任务：任务号、呼叫号、系统自动、设备号、条件触发" type="VARCHAR(16)"/>
            <column name="condition_handler" remarks="条件触发类型下必填，根据业务拓展" type="VARCHAR(255)"/>
            <column name="third_invoke_type" remarks="sqop/rest/tcp" type="VARCHAR(255)"/>
            <column name="third_type" remarks="第三方(应用)类型" type="VARCHAR(255)"/>
            <column name="app_code" remarks="应用编号" type="VARCHAR(255)"/>
            <column name="third_url" remarks="第3方路径" type="VARCHAR(255)"/>
            <column name="third_start_method" remarks="任务开始3方通知方法" type="VARCHAR(255)"/>
            <column name="third_end_method" remarks="任务结束3方通知方法" type="VARCHAR(255)"/>
            <column name="point_access" remarks="如：固定点、线路、呼叫路径、关联点、主叫号、策略配置、电梯等待位、关联区域" type="VARCHAR(255)"/>
            <column name="sequence" remarks="执行顺序" type="INT"/>
            <column name="cancel_flag" remarks="取消标志" type="INT"/>
            <column name="cancel_id" remarks="取消id" type="INT"/>
            <column name="cancel_type" remarks="取消类型" type="VARCHAR(64)"/>
            <column name="group_id" remarks="组id" type="VARCHAR(64)"/>
            <column name="loop_exec" remarks="循环执行" type="VARCHAR(2)"/>
            <column name="priority" remarks="优先级" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561102935905-3">
        <createTable tableName="ts_sub_task_typ">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="sub_task_typ_code" remarks="子任务类型编号" type="VARCHAR(32)"/>
            <column name="sub_task_typ_name" remarks="子任务类型名称" type="VARCHAR(256)"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="is_default" remarks="是否是系统默认" type="INT"/>
            <column name="task_typ" remarks="任务类型标识" type="VARCHAR(256)"/>
            <column name="sub_task_mes_send" remarks="发送消息体" type="VARCHAR(2000)"/>
            <column name="worker_type" remarks="执行者类型" type="VARCHAR(256)"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561102935905-4">
        <createTable tableName="ts_task_group">
            <column autoIncrement="true" name="id" remarks="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="task_group_code" remarks="任务组编号" type="VARCHAR(32)"/>
            <column name="task_group_name" remarks="任务组名称" type="VARCHAR(256)"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="is_default" remarks="是否是系统默认" type="INT"/>
            <column name="task_group_type" remarks="任务组类型" type="VARCHAR(256)"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561102935905-5">
        <createTable tableName="ts_task_group_item">
            <column name="id" remarks="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="sub_task_type_code" remarks="子任务类型编号" type="VARCHAR(32)"/>
            <column name="sub_task_seq" remarks="子任务执行顺序" type="INT"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="is_default" remarks="是否是系统默认" type="INT"/>
            <column name="task_group_code" remarks="任务组编号" type="VARCHAR(32)"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561102935905-6">
        <createTable tableName="ts_task_rel">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="templ_code" remarks="任务模板编号" type="VARCHAR(32)"/>
            <column name="main_task_type_code" remarks="主任务类型编号" type="VARCHAR(256)"/>
            <column name="main_task_seq" remarks="主任务执行顺序" type="INT"/>
            <column name="sub_task_type_code" remarks="子任务类型编号" type="VARCHAR(256)"/>
            <column name="task_group_item_id" remarks="任务组项目id" type="VARCHAR(255)"/>
            <column name="task_group_code" remarks="任务组编号" type="VARCHAR(255)"/>
            <column name="sub_task_seq" remarks="子任务执行顺序" type="INT"/>
            <column name="group_seq" remarks="任务组执行顺序" type="INT"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="need_confirm" remarks="需要确认" type="VARCHAR(2)"/>
            <column name="need_inform" remarks="是否通知" type="VARCHAR(2)"/>
            <column name="need_trigger" remarks="是否需要触发" type="VARCHAR(2)"/>
            <column name="trigger_type" remarks="通过什么字段触发任务：任务号、呼叫号、系统自动、设备号、条件触发" type="VARCHAR(16)"/>
            <column name="condition_handler" remarks="条件触发类型下必填，根据业务拓展" type="VARCHAR(255)"/>
            <column name="third_invoke_type" remarks="sqop/rest/tcp" type="VARCHAR(255)"/>
            <column name="third_type" remarks="第三方(应用)类型" type="VARCHAR(255)"/>
            <column name="app_code" remarks="应用编号" type="VARCHAR(255)"/>
            <column name="third_url" remarks="第3方路径" type="VARCHAR(255)"/>
            <column name="third_start_method" remarks="任务开始3方通知方法" type="VARCHAR(255)"/>
            <column name="third_end_method" remarks="任务结束3方通知方法" type="VARCHAR(255)"/>
            <column name="point_access" remarks="如：固定点、线路、呼叫路径、关联点、主叫号、策略配置、电梯等待位、关联区域" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561102935905-7">
        <addPrimaryKey columnNames="id" constraintName="PRIMARY" tableName="ts_task_group_item"/>
    </changeSet>


    <changeSet author="han (generated)" id="1561103888987-1">
        <createTable tableName="ts_main_task">
            <column autoIncrement="true" name="id" remarks="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="main_task_num" remarks="主任务编号" type="VARCHAR(32)"/>
            <column name="main_task_type_code" remarks="任务类型" type="VARCHAR(256)"/>
            <column name="task_status" remarks="任务状态" type="INT"/>
            <column name="date_chg" remarks="状态变更时间" type="datetime(6)"/>
            <column name="main_task_seq" remarks="主任务顺序" type="INT"/>
            <column name="group_id" remarks="组编号" type="VARCHAR(255)"/>
            <column name="sequence" remarks="执行顺序" type="INT"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="priority" remarks="优先级" type="INT"/>
            <column name="task_group_code" remarks="任务组编号" type="VARCHAR(256)"/>
            <column name="exector_num" remarks="执行者编号、设备号、系统名称" type="VARCHAR(256)"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561103888987-2">
        <createTable tableName="ts_main_task_type">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="main_task_type_code" remarks="主任务类型编号" type="VARCHAR(32)"/>
            <column name="main_task_type_name" remarks="主任务类型名称" type="VARCHAR(256)"/>
            <column name="exec_bean" remarks="执行类" type="VARCHAR(256)"/>
            <column name="priority" remarks="任务优先级" type="INT"/>
            <column name="loop_exec" remarks="循环执行" type="VARCHAR(2)"/>
            <column name="interval_time" remarks="循环间隔时间" type="INT"/>
            <column name="multi_target_task" remarks="目标物是否多任务" type="VARCHAR(2)"/>
            <column name="rel_vice_task_typ" remarks="关联附任务模板" type="VARCHAR(32)"/>
            <column name="create_date" remarks="创建时间" type="datetime(6)"/>
            <column name="remark" remarks="备注" type="VARCHAR(256)"/>
            <column name="is_default" remarks="是否是系统默认模板" type="INT"/>
            <column name="decomp_num" remarks="分解任务个数" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="han (generated)" id="1561103888987-3">
        <createIndex indexName="AK_idx_task_num" tableName="ts_main_task">
            <column name="main_task_num"/>
        </createIndex>
    </changeSet>
</databaseChangeLog>
